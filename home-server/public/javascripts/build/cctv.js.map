{"version":3,"sources":["../src/dashboard.js"],"names":[],"mappings":";;;AACA,CAAC,UAAS,CAAC,EAAE,EAAE,EAAE;AACf,cAAY,CAAC;;AAEb,MAAM,WAAW,GAAG,IAAI,CAAC;AACzB,MAAM,YAAY,GAAG,IAAI,CAAC;AAC1B,MAAM,WAAW,GAAG,IAAI,CAAC;AACzB,MAAM,SAAS,GAAG,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AAC9C,MAAM,QAAQ,GAAG,IAAI,IAAI,CAAC,WAAW,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;AAC3D,MAAM,SAAS,GAAG,QAAQ,GAAG,SAAS,CAAC;;;;AAIvC,WAAS,WAAW,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE;AAC5C,WAAO,CAAC,KAAK,GAAC,IAAI,GAAG,OAAO,GAAC,EAAE,GAAG,OAAO,CAAA,GAAI,KAAK,CAAC;GACpD;;AAED,WAAS,SAAS,CAAC,UAAU,EAAE;AAC7B,QAAI,SAAS,GAAG,UAAU,CAAC,KAAK,CAAC,4BAA4B,CAAC,CAAC;;;AAG/D,WAAO,WAAW,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,EAC1B,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,EAC1B,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;GAChD;;AAED,WAAS,QAAQ,CAAC,UAAU,EAAE;AAC5B,QAAI,SAAS,GAAG,UAAU,CAAC,KAAK,CAAC,0BAA0B,CAAC,CAAC;AAC7D,QAAI,IAAI,GAAG,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;AAClE,WAAO,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,QAAQ,GAAG,SAAS,CAAA,GAAI,SAAS,CAAC;GAC5D;;AAED,MAAI,UAAU,GAAG,EAAE,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,YAAY,CAAC,CAAC,CAAC;AAC5E,MAAI,SAAS,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,MAAM,CAAC,CAAC,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,IAAI,CAAC,WAAW,GAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC,CAAC;;AAE7H,GAAC,CAAC,YAAW;AACX,QAAI,IAAI,GAAG,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CACxB,MAAM,CAAC,GAAG,CAAC,CACX,IAAI,CAAC,WAAW,EAAE,mBAAmB,CAAC,CACxC;;AAED,MAAE,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAA,KAAK,EAAI;AACzB,QAAE,CAAC,IAAI,CAAC,qBAAqB,EAAE,UAAA,QAAQ,EAAI;AACzC,gBAAQ,CAAC,GAAG,CAAC,UAAA,SAAS,EAAI;AACxB,kBAAO,SAAS,CAAC,IAAI;AACnB,iBAAK,OAAO;AACV,uBAAS,CAAC,MAAM,CAAC,GAAG,CAAE,UAAA,KAAK,EAAI;AAC7B,oBAAI,cAAc,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC;AACzD,oBAAI,YAAY,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC;AACvD,oBAAI,QAAQ,GAAG,WAAW,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AACxF,oBAAI,WAAW,GAAG,WAAW,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,QAAQ,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AAC/F,oBAAI,CACD,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAU,CAAC,CACxC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,QAAQ,GAAG,YAAY,CAAC,CAC/C,IAAI,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,WAAW,GAAG,QAAQ,CAAA,GAAI,YAAY,CAAC,CACpF;eACF,CAAC,CAAC;AACL,oBAAM;AAAA,AACN,iBAAK,UAAU;;AAEb,kBAAI,OAAO,GAAG,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC;AACpD,kBAAI,KAAK,GAAG,IAAI,IAAI,CAAC,WAAW,GAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC;;oCAC3C,EAAE;AACT,oBAAI,IAAI,GAAG,IAAI,IAAI,CAAC,EAAE,CAAC,CAAC;AACxB,oBAAI,GAAG,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAC,CAAC,CAAA,GAAE,CAAC,CAAC;AAC9B,yBAAS,CAAC,MAAM,CAAC,GAAG,CAAE,UAAA,KAAK,EAAI;AAC7B,yBAAO,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;AACxB,sBAAI,KAAK,IAAI,GAAG,IAAI,KAAK,CAAC,CAAC,CAAC,IAAI,GAAG,IAAI,KAAK,CAAC,CAAC,CAAC,EAAE;AAC/C,2BAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACnB,wBAAI,CAAC,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;AACxB,wBAAI,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,EAAE,GAAC,IAAI,GAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACzD,wBAAI,CACD,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,WAAW,CAAC,CACzC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CACzB,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,YAAY,CAAC,CACnD;mBACF;iBACF,CAAC,CAAC;;;AAfL,mBAAK,IAAI,EAAE,GAAC,OAAO,EAAE,EAAE,GAAC,KAAK,EAAE,EAAE,IAAE,EAAE,GAAC,IAAI,GAAC,IAAI,EAAE;sBAAxC,EAAE;eAgBV;AACH,oBAAM;AAAA,WACP;SACF,CAAC,CAAC;;AAEH,YAAI,QAAQ,GAAG,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,UAAU,CAAC,UAAA,CAAC;sBAAO,CAAC;SAAK,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AACnG,YAAI,OAAO,GAAG,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;;AAErE,YAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAChC,YAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;;AAE/B,YAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CACtB,IAAI,CAAC,KAAK,CAAC,CACX,KAAK,EAAE,CACL,MAAM,CAAC,KAAK,CAAC,CACX,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CACpB,IAAI,CAAC,YAAY,EAAE,MAAM,CAAC,CAC1B,IAAI,CAAC,GAAG,EAAE,UAAA,CAAC;iBAAI,QAAQ,CAAC,CAAC,CAAC,UAAU,CAAC,GAAG,WAAW;SAAA,CAAC,CACpD,IAAI,CAAC,GAAG,EAAE,UAAA,CAAC;iBAAI,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC,GAAG,YAAY;SAAA,CAAC,CACtD,IAAI,CAAC,gBAAgB,EAAE,UAAA,CAAC;iBAAI,CAAC,CAAC,UAAU;SAAA,CAAC,CACzC,EAAE,CAAC,WAAW,EAAE,UAAA,CAAC,EAAI;AACpB,YAAE,CAAC,MAAM,CAAC,UAAU,CAAC,CAClB,KAAK,CAAC,KAAK,QAAK,EAAE,CAAC,KAAK,CAAC,KAAK,GAAG,EAAE,CAAA,QAAK,CACxC,KAAK,CAAC,MAAM,QAAK,EAAE,CAAC,KAAK,CAAC,KAAK,GAAG,EAAE,CAAA,QAAK,CACzC,KAAK,CAAC,SAAS,EAAE,OAAO,CAAC,CAC3B;AACD,YAAE,CAAC,MAAM,CAAC,cAAc,CAAC,CACtB,IAAI,CAAC,KAAK,OAAK,CAAC,CAAC,IAAI,UAAO,CAC9B;AACD,YAAE,CAAC,MAAM,CAAC,eAAe,CAAC,CACvB,IAAI,CAAC,CAAC,CAAC,UAAU,CAAC,CACpB;SACF,CAAC,CACD,EAAE,CAAC,UAAU,EAAE,YAAM;AACpB,YAAE,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;SAChD,CAAC,CACP;OACF,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ,CAAC,CAAC;CACJ,CAAA,CAAE,CAAC,EAAE,EAAE,CAAC,CAAC","file":"public/javascripts/src/dashboard.js","sourcesContent":["/*global $, d3*/\n(function($, d3) {\n  'use strict';\n\n  const canvasWidth = 3000; // TODO: read from SVG attributes\n  const canvasHeight = 1000;\n  const currentYear = 2015;\n  const firstTime = new Date(currentYear, 0, 1);\n  const lastTime = new Date(currentYear, 11, 31, 23, 59, 59);\n  const mSecsYear = lastTime - firstTime;\n\n  // from a date as currentYear-05-30_21.22.29\n  // return a number from 0 to 1 depending on the time, midnight to midnight\n  function timeMapping(hours, minutes, seconds) {\n    return (hours*3600 + minutes*60 + seconds) / 86400;\n  }\n\n  function timeOfDay(dateString) {\n    var timeMatch = dateString.match(/_(\\d{2})\\.(\\d{2})\\.(\\d{2})/);\n    // console.log(timeMatch);\n    // console.log(timeMapping(timeMatch[1], timeMatch[2], timeMatch[3]));\n    return timeMapping(parseInt(timeMatch[1], 10),\n                       parseInt(timeMatch[2], 10),\n                       parseInt(timeMatch[3], 10));\n  }\n\n  function scaleDay(dateString) {\n    var dateMatch = dateString.match(/^(\\d{4})-(\\d{2})-(\\d{2})/);\n    var date = new Date(dateMatch[1], dateMatch[2] - 1, dateMatch[3]);\n    return (date.getTime() + 43200000 - firstTime) / mSecsYear;\n  }\n\n  var hoursScale = d3.scale.linear().domain([0, 24]).range([0, canvasHeight]);\n  var daysScale = d3.time.scale().domain([new Date(currentYear, 0, 1), new Date(currentYear+1, 0, 1)]).range([0, canvasWidth]);\n\n  $(function() {\n    var plot = d3.select('svg')\n      .append('g')\n      .attr('transform', 'translate(54, 30)')\n    ;\n\n    d3.json('/media', media => {\n      d3.json('/data/schedule.json', schedule => {\n        schedule.map(intervals => {\n          switch(intervals.type) {\n            case 'hours':\n              intervals.ranges.map( range => {\n                var startTimeMatch = range[0].match(/^(\\d{2}):(\\d{2})$/);\n                var endTimeMatch = range[1].match(/^(\\d{2}):(\\d{2})$/);\n                var topLeftY = timeMapping(parseInt(startTimeMatch[1]), parseInt(startTimeMatch[2]), 0);\n                var bottomLeftY = timeMapping(parseInt(endTimeMatch[1], 10), parseInt(endTimeMatch[2], 10), 0);\n                plot\n                  .append('rect').attr('class', 'interval')\n                  .attr('x', 0).attr('y', topLeftY * canvasHeight)\n                  .attr('width', canvasWidth).attr('height', (bottomLeftY - topLeftY) * canvasHeight)\n                ;\n              });\n            break;\n            case 'weekdays':\n              // loop through all days in the year and highlight if day isn't in interval\n              let startMs = new Date(currentYear, 0, 1).getTime();\n              let endMs = new Date(currentYear+1, 0, 1).getTime();\n              for (let ms=startMs; ms<endMs; ms+=24*3600*1000) {\n                let date = new Date(ms);\n                let dow = (date.getDay()+1)%7;\n                intervals.ranges.map( range => {\n                  console.log(range, dow);\n                  if (range && dow >= range[0] && dow <= range[1]) {\n                    console.log('yes');\n                    let x = daysScale(date);\n                    let width = daysScale(date.getTime() + 24*3600*1000) - x;\n                    plot\n                      .append('rect').attr('class', 'interval2')\n                      .attr('x', x).attr('y', 0)\n                      .attr('width', width).attr('height', canvasHeight)\n                    ;\n                  }\n                });\n              }\n            break;\n          }\n        });\n\n        let timeAxis = d3.svg.axis().scale(hoursScale).ticks(24).tickFormat(d => `${d}:00`).orient('left');\n        let dayAxis = d3.svg.axis().scale(daysScale).ticks(12).orient('top');\n\n        plot.append('g').call(timeAxis);\n        plot.append('g').call(dayAxis);\n\n        plot.selectAll('use.dot')\n          .data(media)\n          .enter()\n            .append('use')\n              .attr('class', 'dot')\n              .attr('xlink:href', '#dot')\n              .attr('x', d => scaleDay(d.filePrefix) * canvasWidth)\n              .attr('y', d => timeOfDay(d.filePrefix) * canvasHeight)\n              .attr('data:date-time', d => d.filePrefix)\n              .on('mouseover', d => {\n                d3.select('#tooltip')\n                  .style('top', `${d3.event.pageY - 80}px`)\n                  .style('left', `${d3.event.pageX + 10}px`)\n                  .style('display', 'block')\n                ;\n                d3.select('#tooltip img')\n                  .attr('src', `${d.href}.jpg`)\n                ;\n                d3.select('#tooltip span')\n                  .text(d.filePrefix)\n                ;\n              })\n              .on('mouseout', () => {\n                d3.select('#tooltip').style('display', 'none');\n              })\n        ;\n      });\n    });\n  });\n})($, d3);\n"]}